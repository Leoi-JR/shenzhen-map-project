# 标记点应用

这是一个基于React和TypeScript的标记点应用，允许用户在手绘地图上标记点并与腾讯地图进行对应。

## 功能特点

### 主要功能
- **手绘地图上传**: 支持拖拽上传图片作为手绘地图背景
- **点击标记**: 在手绘地图上点击任意位置添加标记点
- **腾讯地图集成**: 为每个标记点选择对应的腾讯地图位置
- **坐标数据管理**: 自动记录和管理坐标映射关系
- **数据导出**: 支持将映射数据保存为JSON文件
- **历史数据管理**: 查看、加载、删除已保存的数据文件

### 交互特性
- **实时反馈**: 点击后立即显示标记点和坐标信息
- **标记点编辑**: 可以删除或重新定位标记点
- **坐标转换**: 自动将点击位置转换为归一化坐标（相对于图片尺寸）
- **数据验证**: 确保数据完整性和格式正确性

### 数据管理
- **自动保存**: 支持自动生成文件名并保存地图数据
- **文件历史**: 显示所有已保存的数据文件列表
- **数据加载**: 可以加载已保存的数据继续编辑
- **数据导出**: 支持下载已保存的JSON文件
- **数据删除**: 支持删除不需要的数据文件

## 技术架构

### 前端技术栈
- **React**: 用户界面框架
- **TypeScript**: 类型安全的JavaScript超集
- **React Hooks**: 现代化的状态管理
- **CSS3**: 样式和动画效果
- **腾讯地图API**: 地图服务集成
- **UUID**: 唯一标识符生成

### 后端集成
- **Flask API**: 与后端服务集成
- **文件管理**: 数据的保存、加载、删除功能
- **JSON数据格式**: 标准化的数据交换格式

### 数据结构
每个标记点包含以下信息：
- **唯一标识符**: 用于标记点的唯一标识
- **手绘地图坐标**: 基于图片像素的位置和归一化坐标
- **腾讯地图坐标**: 经纬度坐标信息
- **时间戳**: 标记点创建时间

## 安装和使用

### 1. 环境准备

```bash
# 进入标记点目录
cd 标记点

# 安装依赖
npm install

# 启动后端服务（如果尚未启动）
cd ../backend
python start_server.py
```

### 2. 启动应用

```bash
# 返回标记点目录
cd ../标记点

# 启动应用
npm start
```

### 3. 使用步骤

#### 步骤1：上传手绘地图
1. 点击“上传手绘地图”按钮或拖拽图片到上传区域
2. 支持的图片格式：JPG、PNG、GIF、BMP、WEBP
3. 图片上传成功后会显示在左侧区域

#### 步骤2：标记点位置
1. 在手绘地图上点击要标记的位置
2. 系统会自动在点击位置处显示红色标记点
3. 在坐标列表中会自动添加一条记录

#### 步骤3：选择腾讯地图位置
1. 在右侧的腾讯地图上点击对应的位置
2. 选择地图位置后，对应的坐标记录会更新
3. 可以反复点击调整位置直到满意

#### 步骤4：管理标记点
1. 在坐标列表中查看所有标记点信息
2. 点击“删除”按钮可以移除不需要的标记点
3. 实时查看坐标转换结果

#### 步骤5：保存数据
1. 点击“保存地图数据”按钮
2. 系统会自动生成文件名并保存数据
3. 文件命名格式：`坐标映射数据_YYYY-MM-DD_HH-MM-SS.json`

#### 步骤6：数据管理
1. 在“已保存的文件”区域查看所有历史数据
2. 点击“加载”可以重新加载之前的数据
3. 点击“下载”可以下载原始JSON文件
4. 点击“删除”可以删除不需要的数据

## 数据格式

### 输出JSON文件格式

```json
{
  "metadata": {
    "createdAt": "2025-01-13T10:30:00Z",
    "version": "1.0",
    "description": "坐标映射数据",
    "totalPoints": 3,
    "mapImageInfo": {
      "filename": "map.jpg",
      "size": {"width": 800, "height": 600},
      "uploaded": "2025-01-13T10:25:00Z"
    }
  },
  "mappings": [
    {
      "id": "unique-id-1",
      "腾讯地图坐标": {
        "经度": 113.936,
        "纬度": 22.534
      },
      "手绘地图坐标": {
        "x": 0.25,
        "y": 0.30,
        "pixelX": 200,
        "pixelY": 180
      },
      "timestamp": "2025-01-13T10:26:00Z"
    }
  ]
}
```

### 坐标系说明

- **腾讯地图坐标**: 标准的WGS84坐标系经纬度
- **手绘地图坐标**: 
  - `x`, `y`: 归一化坐标（0-1范围，相对于图片尺寸）
  - `pixelX`, `pixelY`: 像素坐标（相对于图片的实际像素位置）

## 目录结构

```
标记点/
├── public/
│   └── index.html          # 入口HTML文件
├── src/
│   ├── App.tsx            # 主组件
│   ├── App.css            # 主样式
│   ├── index.tsx          # 入口文件
│   ├── index.css          # 全局样式
│   ├── types/
│   │   └── index.ts       # TypeScript类型定义
│   └── components/        # 组件目录
│       ├── ImageMapArea/  # 手绘地图组件
│       ├── TencentMapArea/ # 腾讯地图组件
│       ├── CoordinateList/ # 坐标列表组件
│       └── SavedFilesList/ # 文件列表组件
├── package.json           # 依赖配置
├── tsconfig.json          # TypeScript配置
├── README.md             # 说明文档
├── 使用说明.md           # 使用说明
└── saved-data123/         # 数据存储目录
    └── *.json            # 已保存的数据文件
```

## 接口说明

### 后端API接口

应用会调用以下后端接口：

1. **保存数据**: `POST /api/save-json`
2. **获取文件列表**: `GET /api/saved-files`
3. **下载文件**: `GET /api/download/<filename>`
4. **删除文件**: `DELETE /api/delete/<filename>`

### 腾讯地图API

使用腾讯地图的JavaScript API：
- **地图显示**: 初始化地图容器和显示
- **点击事件**: 获取用户点击位置的经纬度
- **标记显示**: 在地图上显示标记点

## 注意事项

### 使用限制
- 需要有效的腾讯地图API密钥
- 支持的图片格式：JPG、PNG、GIF、BMP、WEBP
- 图片大小建议不超过10MB
- 需要现代浏览器支持（支持ES6+）

### 数据安全
- 所有数据都保存在本地服务器
- 支持数据备份和恢复
- 数据格式符合JSON标准

### 性能优化
- 使用React的虚拟列表优化大量数据显示
- 图片上传支持压缩和预览
- 异步加载保证用户体验流畅

## 开发说明

### 代码结构

项目采用组件化架构：

1. **主组件** (`App.tsx`): 应用的主入口，处理所有状态管理
2. **功能组件**: 每个功能模块都有独立的组件
3. **类型定义**: 使用TypeScript提供类型安全
4. **样式分离**: 每个组件都有对应的CSS文件

### 状态管理

使用React Hooks进行状态管理：
- `useState`: 管理组件局部状态
- `useEffect`: 处理副作用和生命周期
- `useCallback`: 优化性能和避免不必要的重新渲染
- `useRef`: 管理DOM引用和可变值

### 数据流

1. **用户交互** → 触发事件
2. **事件处理** → 更新组件状态
3. **状态变化** → 触发组件重新渲染
4. **数据持久化** → 调用后端接口

### 扩展性

- 组件化设计便于功能扩展
- TypeScript类型系统保证代码质量
- 模块化样式便于维护和修改
- 标准化数据格式便于与其他系统集成

## 常见问题

### 问题排查

1. **地图不显示**: 检查腾讯地图API密钥是否有效
2. **图片上传失败**: 检查图片格式和大小是否符合要求
3. **数据保存失败**: 检查后端服务是否启动正常
4. **标记点不显示**: 检查浏览器控制台是否有错误信息

### 性能优化

1. **大图片处理**: 建议在上传前对图片进行适当压缩
2. **标记点数量**: 建议每个地图的标记点数量不超过100个
3. **数据管理**: 定期清理不需要的数据文件

### 浏览器支持

- **推荐浏览器**: Chrome 88+、Firefox 85+、Safari 14+、Edge 88+
- **移动端**: 支持触摸操作，但建议使用桌面端获得更好体验
- **屏幕分辨率**: 支持响应式设计，但建议使用至少 1024x768 的分辨率

这个应用为深大地图项目提供了完整的标记点创建和管理解决方案，支持与腾讯地图的无缝集成，为后续的地图映射功能提供了必要的数据支持。 