# 地图映射应用

这是一个基于React的地图映射应用，允许用户上传手绘地图并与腾讯地图进行交互。支持动态选择坐标映射文件，实现灵活的坐标变换。

## 功能特点

- **动态文件选择**: 支持从多个坐标映射文件中选择用于变换
- **实时坐标映射**: 基于选择的映射文件实时计算仿射变换
- **手绘地图上传**: 支持上传图片作为手绘地图
- **图片交互操作**: 支持缩放、平移、拖拽操作
- **腾讯地图集成**: 自动加载腾讯地图
- **标记同步**: 在腾讯地图上点击时，通过仿射变换在手绘地图上显示对应位置标记
- **坐标输出**: 实时显示点击位置的经纬度坐标
- **响应式设计**: 适配不同屏幕尺寸

## 使用方法

### 1. 环境准备

```bash
# 安装依赖
npm install

# 启动后端服务（如果尚未启动）
cd ../backend
python app.py
```

### 2. 启动应用

```bash
npm start
```

### 3. 使用步骤

1. **选择映射文件**: 在页面顶部的下拉框中选择要使用的坐标映射JSON文件
   - 这些文件来自标记点项目保存的映射数据
   - 支持实时切换不同的映射文件
   - 显示文件大小和创建时间信息

2. **上传手绘地图**: 点击“选择文件”或拖拽上传手绘地图图片

3. **交互操作**: 使用鼠标滚轮缩放图片，拖拽平移图片，双击重置

4. **坐标映射**: 在腾讯地图上点击任意位置
   - 系统会根据选择的映射文件进行坐标变换
   - 在手绘地图上显示对应位置的标记
   - 在输出区域显示坐标信息

5. **查看结果**: 在坐标输出区域查看：
   - 点击位置的经纬度坐标
   - 使用的映射文件名称
   - 映射状态信息

## 坐标映射文件

映射文件是从标记点项目生成的JSON文件，包含：
- 腾讯地图坐标（经纬度）
- 手绘地图坐标（归一化0-1坐标）
- 元数据信息

文件存储在 `backend/saved-data/` 目录下，格式如下：

```json
{
  "metadata": {
    "createdAt": "2025-01-13T10:00:00Z",
    "version": "1.0",
    "description": "坐标映射数据",
    "totalPoints": 10
  },
  "mappings": [
    {
      "腾讯地图坐标": {"经度": 113.936, "纬度": 22.534},
      "手绘地图坐标": {"x": 0.2, "y": 0.3}
    }
  ]
}
```

## 图片操作说明

- **缩放**: 使用鼠标滚轮或触摸板缩放图片
- **平移**: 拖拽图片进行平移
- **重置**: 双击图片重置到初始状态
- **缩放范围**: 0.5x - 4x

## 技术架构

### 前端技术栈
- **React**: 用户界面框架
- **react-zoom-pan-pinch**: 图片缩放平移组件
- **react-dropzone**: 文件拖拽上传组件
- **腾讯地图API**: 地图服务
- **CSS3**: 样式和动画

### 后端技术栈
- **Flask**: Web框架
- **NumPy**: 数值计算
- **SciPy**: 科学计算（Delaunay三角剖分）
- **JSON**: 数据交换格式

### 核心算法
- **Delaunay三角剖分**: 将坐标点构建为三角形网格
- **仿射变换**: 基于三角形对应关系计算坐标变换矩阵
- **实时计算**: 每次选择文件后动态计算变换矩阵

## API接口说明

### 后端API
- `GET /api/mapping-files`: 获取可用的映射文件列表
- `POST /api/coordinate`: 坐标映射转换（需要提供jsonFile参数）
- `POST /api/mapping-info`: 获取特定文件的映射信息
- `GET /api/health`: 健康检查

### 请求示例
```javascript
// 坐标映射请求
fetch('/api/coordinate', {
  method: 'POST',
  headers: {'Content-Type': 'application/json'},
  body: JSON.stringify({
    coordinates: [113.936, 22.534],
    jsonFile: 'mapping_data_20250113.json'
  })
})
```

## 注意事项

- 请确保有有效的腾讯地图API密钥
- 支持的图片格式：jpg, jpeg, png, gif, bmp, webp
- 映射文件需要至少包吧3个以上的坐标点才能进行三角剖分
- 坐标映射精度取决于映射文件中标记点的数量和分布
- 需要现代浏览器支持

## 工作流程

1. **标记点项目**: 用户在手绘地图上标记点，选择对应的腾讯地图位置，保存映射数据
2. **地图映射项目**: 选择保存的映射文件，实时计算仿射变换，实现坐标映射

## 目录结构

```
地图映射/
├── public/
│   └── index.html          # 入口HTML文件
├── src/
│   ├── App.js             # 主组件
│   ├── App.css            # 主样式
│   ├── index.js           # 入口文件
│   └── index.css          # 全局样式
├── package.json           # 依赖配置
└── README.md             # 说明文档
```

## 开发说明

代码设计遵循简洁高效的原则：
- 使用React Hooks管理状态
- 组件化设计，易于维护
- 响应式布局，适配移动端
- 动态文件选择，灵活配置
- 实时计算，确保数据准确性

## 核心依赖

- `react-zoom-pan-pinch`: 提供图片缩放、平移、拖拽功能
- `react-dropzone`: 提供文件拖拽上传功能
- `react` & `react-dom`: React框架
- `react-scripts`: 开发和构建工具 